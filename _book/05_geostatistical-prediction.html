<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Model-based geostatistics for global public health using R - 5&nbsp; Geostatistical prediction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06_case-studies.html" rel="next">
<link href="./04_model-validation.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05_geostatistical-prediction.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Geostatistical prediction</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Model-based geostatistics for global public health using R</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_handling-spatial-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Handling of spatial data in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_model-fitting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model formulation and parameter estimation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_model-validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Model validation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_geostatistical-prediction.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Geostatistical prediction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_case-studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Case studies</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#list-of-the-main-functions-used-in-the-chapter" id="toc-list-of-the-main-functions-used-in-the-chapter" class="nav-link active" data-scroll-target="#list-of-the-main-functions-used-in-the-chapter">List of the main functions used in the chapter</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">5.1</span> Introduction</a></li>
  <li><a href="#sec-spat-pred-target" id="toc-sec-spat-pred-target" class="nav-link" data-scroll-target="#sec-spat-pred-target"><span class="header-section-number">5.2</span> Spatial prediction using geostatistical models</a>
  <ul class="collapse">
  <li><a href="#sec-pred-samples" id="toc-sec-pred-samples" class="nav-link" data-scroll-target="#sec-pred-samples"><span class="header-section-number">5.2.1</span> Generating samples from the predictive distribution of <span class="math inline">\(S(\tilde{X})\)</span> (continue from <span>Section&nbsp;3.3.1</span>)</a></li>
  </ul></li>
  <li><a href="#spatially-continuous-targets" id="toc-spatially-continuous-targets" class="nav-link" data-scroll-target="#spatially-continuous-targets"><span class="header-section-number">5.3</span> Spatially continuous targets</a>
  <ul class="collapse">
  <li><a href="#sec-non-spar-covariates" id="toc-sec-non-spar-covariates" class="nav-link" data-scroll-target="#sec-non-spar-covariates"><span class="header-section-number">5.3.1</span> Example: mapping malaria using age and elevation as predictors</a></li>
  </ul></li>
  <li><a href="#areal-level-targets" id="toc-areal-level-targets" class="nav-link" data-scroll-target="#areal-level-targets"><span class="header-section-number">5.4</span> Areal-level targets</a></li>
  <li><a href="#comparing-the-predictive-performance-of-geostatistical-models" id="toc-comparing-the-predictive-performance-of-geostatistical-models" class="nav-link" data-scroll-target="#comparing-the-predictive-performance-of-geostatistical-models"><span class="header-section-number">5.5</span> Comparing the predictive performance of geostatistical models</a></li>
  <li><a href="#sec-theory-prediction" id="toc-sec-theory-prediction" class="nav-link" data-scroll-target="#sec-theory-prediction"><span class="header-section-number">5.6</span> Theory</a>
  <ul class="collapse">
  <li><a href="#sec-pred-distr-theory" id="toc-sec-pred-distr-theory" class="nav-link" data-scroll-target="#sec-pred-distr-theory"><span class="header-section-number">5.6.1</span> Derivation of the predictive distribution</a></li>
  <li><a href="#scoring-rules" id="toc-scoring-rules" class="nav-link" data-scroll-target="#scoring-rules"><span class="header-section-number">5.6.2</span> Scoring rules</a></li>
  </ul></li>
  <li><a href="#common-questions-from-users" id="toc-common-questions-from-users" class="nav-link" data-scroll-target="#common-questions-from-users"><span class="header-section-number">5.7</span> Common questions from users</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">5.8</span> Exercises</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-geo-prediction" class="quarto-section-identifier"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Geostatistical prediction</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="list-of-the-main-functions-used-in-the-chapter" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="list-of-the-main-functions-used-in-the-chapter">List of the main functions used in the chapter</h2>
<table class="table">
<colgroup>
<col style="width: 34%">
<col style="width: 25%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>R Package</th>
<th>Used for</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>pred_over_grid</code></td>
<td><code>RiskMap</code></td>
<td>Predicting the different component of the linear predictor over a grid: the covariates effects and the random effects</td>
</tr>
<tr class="even">
<td><code>pred_target_grid</code></td>
<td><code>RiskMap</code></td>
<td>Predictions of target defined at pixel-level</td>
</tr>
<tr class="odd">
<td><code>pred_target_shp</code></td>
<td><code>RiskMap</code></td>
<td>Predictions of targets defined at areal level</td>
</tr>
</tbody>
</table>
</section>
<section id="introduction" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">5.1</span> Introduction</h2>
<p>Geostatistics was originally developed and applied as a predictive tool for improving mining operations and planning. In the seminal paper on model-based geostatistics (MBG) <span class="citation" data-cites="diggle1998">(<a href="references.html#ref-diggle1998" role="doc-biblioref">Diggle, Tawn, and Moyeed 1998</a>)</span>, the authors begin by stating:</p>
<blockquote class="blockquote">
<p>*“Conventional geostatistical methodology solves the problem of predicting the realized value of a linear functional of a Gaussian spatial stochastic process* <span class="math inline">\(S(x)\)</span> based on observations <span class="math inline">\(Y_i= S(x_i) + Z_i\)</span> at sampling locations <span class="math inline">\(x_i\)</span>, where the <span class="math inline">\(Z_i\)</span> are mutually independent, zero-mean Gaussian random variables.”</p>
</blockquote>
<p>It is no coincidence that, although MBG represents a broad class of statistical models applicable to both estimation and prediction problems, the majority of its applications have focused on prediction. This is evident in many scientific fields where MBG has been used, including global public health, which is the primary application focus in this book. In line with the quote above, for most of the examples considered in this book, the analyses we illustrate aim to use a finite set of locations <span class="math inline">\(x_i\)</span> — typically corresponding to households or villages — to make inferences about an observed disease risk surface. Having performed estimation of MBG models in <a href="03_model-fitting.html"><span>Chapter&nbsp;3</span></a>, we can now carry out spatial prediction to answer critical public health questions, such as identifying hot-spots and cold-spots — areas of unusually high or low disease risk, respectively — or determining whether the average prevalence across a region exceeds a predefined policy threshold.</p>
<p>In this chapter, we will explore these issues, beginning with a formal statistical formulation of the spatial prediction problem and a description of the necessary steps for its implementation. We will then demonstrate how spatial prediction is performed when considering predictive targets at both the <em>pixel-level</em> and <em>areal-level</em>. Finally, we will conclude the chapter by presenting methods for comparing the predictive performance of different models, with some insights into their relative strengths and weaknesses.</p>
</section>
<section id="sec-spat-pred-target" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="sec-spat-pred-target"><span class="header-section-number">5.2</span> Spatial prediction using geostatistical models</h2>
<p>Let us consider the class of generalized linear geostatistical models (GLGM) as in <a href="01_intro.html#sec-geostat-models"><span>Section&nbsp;1.5</span></a>. In the formulation of prediction problems, the first step consists of defining our predictive target, which we denote as <span class="math inline">\(T(x)\)</span> where <span class="math inline">\(x\)</span> denotes any locations within the study, which is usually not part of the sampled data. For example in the analysis of the riverblindness in Liberia, our interest lies in identifying areas where disease prevalence exceeds 20<span class="math inline">\(\%\)</span>, a threshold that use been used in the past to identify areas in need of mass drug administration due to the potential for significant disease burden and transmission <span class="citation" data-cites="amazigo2008">(<a href="references.html#ref-amazigo2008" role="doc-biblioref">Amazigo 2008</a>)</span>. Hence, in this case, disease prevalence corresponds to our predictive target <span class="math inline">\(T(x)\)</span>. To draw inferences on <span class="math inline">\(T(x)\)</span> and allow us to answer the question of where <span class="math inline">\(T(x)\)</span> exceeds a 20<span class="math inline">\(\%\)</span> threshold, we first need to obtain the so called <em>predictive distribution</em> of <span class="math inline">\(T(x)\)</span>. More specifically, the <em>predictive distribution</em> of <span class="math inline">\(T(x)\)</span> is the distribution of <span class="math inline">\(T(x)\)</span> conditioned to the data, which we denote by <span class="math inline">\([T(x) \: \mid \: y]\)</span>. More importantly, by incorporating the information provided by the data, the predictive distribution of the target enables us to quantify the uncertainty stemming from the stochastic nature of the process we are modeling. In other words, the predictive distribution reflects the range of possible values that the target <span class="math inline">\(T(x)\)</span> can take and their likelihoods based on the model we have fitted to the data. As we shall see in our examples, we can use the predictive distribution of <span class="math inline">\(T(x)\)</span> both to provide what is our “best guess” for <span class="math inline">\(T(x)\)</span> and a summary of uncertainty which quantifies how much concentrated is the predictive distribution around that guess. However, providing a single “best guess” for <span class="math inline">\(T(x)\)</span> is not always the answer to our research question. In the example on riverblindness mentioned at the start of the this section, a more natural way to use the predictive distribution would be to compute the likelihood that <span class="math inline">\(T(x)\)</span> exceeds 0.2 at any given location <span class="math inline">\(x\)</span>.</p>
<p>In summary, the first two steps of spatial prediction are:</p>
<ul>
<li><p>Step 1. define the predictive target <span class="math inline">\(T(x)\)</span>;</p></li>
<li><p>Step 2. obtain the predictive distribution of <span class="math inline">\(T(x)\)</span> and use this to compute summaries that helps to answer your original research question.</p></li>
</ul>
<p>This begs two practical questions: “How do we obtain the predictive distribution of <span class="math inline">\(T(x)\)</span>?” and “How do we use the predictive distribution to compute our summaries?”. For a mathematical derivation of the predictive distribution and the form that this takes in the special case of a linear geostatistical model, you can read <a href="#sec-theory-prediction"><span>Section&nbsp;5.6</span></a>. In what follows, we shall assume that we can simulate directly from <span class="math inline">\([T(x) \: \mid \: y]\)</span> either using direct simulation or Markov Chains Monte Carlo (see <a href="03_model-fitting.html#sec-mcmc-mala"><span>Section&nbsp;3.4.2.2</span></a>).</p>
<p>In our exposition so far, we have also made the implicit assumption that prediction is required for our predictive target at a single, unsampled, location <span class="math inline">\(x\)</span> and for this reason we have denote our predictive target simply as <span class="math inline">\(T(x)\)</span>. However, this is almost never the case, since in most cases, our predictive target correspond to either of the following.</p>
<ul>
<li><p><strong>Spatially continuous targets</strong> correspond to an unobserved spatially continuous surface (e.g.&nbsp;disease prevalence), formally denoted by <span class="math inline">\(\mathcal{T} = \{T(x), x \in A\}\)</span>, where <span class="math inline">\(A\)</span> is our region of interest.</p></li>
<li><p><strong>Areal-level targets</strong>, usually defined as transformation of the spatially continuous surface <span class="math inline">\(\mathcal{T}\)</span>, defined previously, and which we denote as <span class="math inline">\(\mathcal{T}_{A} = F(\mathcal{T}, A)\)</span>. For example, the average of <span class="math inline">\(T(x)\)</span> over <span class="math inline">\(A\)</span> is an areal-level target, formally defined as <span class="math inline">\(F(\mathcal{T}, A) = \int_{A} T(x) \: dx / |A|\)</span>, where <span class="math inline">\(|A|\)</span> is the area of <span class="math inline">\(A\)</span>.</p></li>
</ul>
<p>Before we consider these two types of prediction targets more in detail, we first explain the preliminary steps that need to be performed and are common to both. Whether our goal is predict a spatially continuous or areal-level target, the initial task is to draw Monte Carlo samples from the predictive distribution of the spatial process <span class="math inline">\(S(x)\)</span><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Next, we define a set of prediction locations, say <span class="math inline">\(q\)</span> in total, denoted as <span class="math inline">\(\tilde{X} = {\tilde{x}_1, \ldots, \tilde{x}_q}\)</span>. These locations correspond to a regular grid that spans our region of interest, <span class="math inline">\(A\)</span>. the predictive distribution of the spatial process over the grid, represented as <span class="math inline">\([S(\tilde{X}) \: |\: y]\)</span>. This distribution allows us to generate Monte Carlo samples for <span class="math inline">\(S(\tilde{X})\)</span>, which will later be used for computing our target.</p>
<p>At this stage, we need to consider which of the two following types of predictions from <span class="math inline">\([S(\tilde{X}) \: |\: y]\)</span> are required.</p>
<ul>
<li><p><strong>Marginal predictions</strong> are obtained by simulating independently from the <span class="math inline">\(q\)</span> marginal predictive distributions of <span class="math inline">\([S(\tilde{X}) | y]\)</span>. In other words, we consider a prediction location <span class="math inline">\(\tilde{x}_j\)</span>, simulate from <span class="math inline">\([S(\tilde{x}_j) \: |\: y]\)</span> say <span class="math inline">\(B\)</span> samples, and repeat this for <span class="math inline">\(j=1,\ldots,q\)</span></p></li>
<li><p><strong>Joint predictions</strong> are obtained by simulating from the joint distribution of <span class="math inline">\([S(\tilde{X}) \: |\: y]\)</span>. Unlike marginal predictions, joint predictions take into account the correlation between the different components of <span class="math inline">\([S(\tilde{X}) \: |\: y]\)</span>.</p></li>
</ul>
<p>To better understand the technical differences between marginal and joint predictions, we refer you to <a href="#sec-pred-distr-theory"><span>Section&nbsp;5.6.1</span></a>. However, in practice, the two following facts are important.</p>
<ul>
<li><p><em>Fact 1</em>. Joint predictions are computationally more intensive than marginal predictions.</p></li>
<li><p><em>Fact 2</em>. Joint predictions are required when the predictive target is at areal-level.</p></li>
<li><p><em>Fact 3</em>. For spatially continuous targets, both marginal and joint predictions can be used but, in light of <em>Fact 1</em>, we might prefer using the former.</p></li>
</ul>
<section id="sec-pred-samples" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="sec-pred-samples"><span class="header-section-number">5.2.1</span> Generating samples from the predictive distribution of <span class="math inline">\(S(\tilde{X})\)</span> (continue from <a href="03_model-fitting.html#sec-liberia-estim1"><span>Section&nbsp;3.3.1</span></a>)</h3>
<p>We now show how the ideas and concepts discussed above are put into practice in an geostatistical analysis, using the Liberia data example. Using the fitted model in <a href="03_model-fitting.html#sec-liberia-estim1"><span>Section&nbsp;3.3.1</span></a>, we use the <code>predict_over_grid</code> function in <code>RiskMap</code>, to sample from the predictive distribution of the spatial Gaussian process <span class="math inline">\(S(x)\)</span> based on a regular grid spanning the country of Liberia.</p>
<p>The <code>pred_over_grid</code> function enables us to predict the the separate effects of the covariates, given by <span class="math inline">\(d(x)^\top \beta\)</span>, and the spatial random effects, <span class="math inline">\(S(x)\)</span>, at any desired location <span class="math inline">\(x\)</span>. Hence, before we can use the <code>pred_over_grid</code> function, we need to do 1) obtain a shape file that defines the boundaries of our study area, 2) use that to create a regular grid and 3) extract the covariates values at those locations. The R script below performs all these steps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Obtaining Liberia boundaries </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgeoboundaries)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>liberia_adm0 <span class="ot">&lt;-</span> <span class="fu">geoboundaries</span>(<span class="st">"liberia"</span>, <span class="at">adm_lvl =</span> <span class="st">"adm0"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>liberia_adm0 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(liberia_adm0, <span class="at">crs =</span> <span class="dv">32629</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Create the grid at 5 km resolution</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>liberia_grid <span class="ot">&lt;-</span> <span class="fu">create_grid</span>(liberia_adm0, <span class="at">spat_res =</span> <span class="dv">5</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Download elevation data</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(elevatr)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>liberia_elev <span class="ot">&lt;-</span> <span class="fu">get_elev_raster</span>(<span class="at">locations =</span> liberia_adm0, </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>                                <span class="at">z =</span> <span class="dv">5</span>, <span class="at">clip =</span> <span class="st">"locations"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Extracting elevation at the grid locations</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>lb_predictors <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">elevation =</span> </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>                         terra<span class="sc">::</span><span class="fu">extract</span>(liberia_elev,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">st_coordinates</span>(liberia_grid)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the code above, we generated a prediction grid — which, we recall, that we denote as <span class="math inline">\(\tilde{X}\)</span> — with a spatial resolution of 5 km. Generally, a higher spatial resolution (note that a “higher spatial resolution” corresponds to a lower value for <code>spat_res</code>) yields more detailed prediction maps but also increases the computational cost. In this case, the choice of a 5 km grid strikes a balance between sufficient visualization clarity and manageable computation time.</p>
<p>At this point, we have all the necessary inputs to execute the <code>pred_over_grid</code> function for both marginal and joint predictions, as demonstrated below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting the spatial process S(x) over the grid, as well as</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># covariates effects</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Marginal predictions</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>lb_pred_S_m <span class="ot">&lt;-</span> <span class="fu">pred_over_grid</span>(fit_liberia, </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">grid_pred =</span> liberia_grid, </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">predictors =</span> lb_predictors, <span class="at">messages =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">type =</span> <span class="st">"marginal"</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Joint predictions</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>lb_pred_S_j <span class="ot">&lt;-</span> <span class="fu">pred_over_grid</span>(fit_liberia, </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                            <span class="at">grid_pred =</span> liberia_grid, </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">predictors =</span> lb_predictors, <span class="at">messages =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">type =</span> <span class="st">"joint"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Both <code>lb_pred_S_m</code> and <code>lb_pred_S_j</code> contain lists with the same arguments, with one key difference: the samples in the list element named <code>S_samples</code> for the former are drawn from the marginal predictive distributions of the components of <span class="math inline">\(S(\tilde{X})\)</span>, while for the latter, they come from the joint predictive distribution of <span class="math inline">\(S(\tilde{X})\)</span>.</p>
<p>An important note is that in the code above we have used the default settings for the Markov Chain Monte Carlo (MCMC). To change these setting use the function <code>set_control_sim</code> whose output should be passed to the argument <code>contol_sim</code> of <code>pred_over_grid</code>. The diagnostic on the convergence of the MCMC can also be applying the <code>check_mcmc</code> function to either <code>lb_pred_S_m</code> or <code>lb_pred_S_j</code>; see <a href="03_model-fitting.html#sec-summary"><span>Section&nbsp;3.4.2.3</span></a> for more details.</p>
<p>We can inspect the predictive distribution of any component <span class="math inline">\(S(\tilde{X})\)</span> through the Monte Carlo samples stored in <code>S_samples</code>. For example, the script below generates the histogram for the predictive distribution of the first component of <span class="math inline">\(S(\tilde{X})\)</span> (<a href="#fig-hist-first-comp-pd">Figure&nbsp;<span>5.1</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(lb_pred_S_m<span class="sc">$</span>S_samples[,<span class="dv">1</span>], <span class="at">main =</span> <span class="st">"Predictive distribution"</span>,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">S</span>(<span class="fu">tilde</span>(x)[<span class="dv">1</span>])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-hist-first-comp-pd" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="05_geostatistical-prediction_files/figure-html/fig-hist-first-comp-pd-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5.1: Histrogram of the predictive distribution of the first component, <span class="math inline">\(S(\tilde{x}_1)\)</span> of <span class="math inline">\(S(\tilde{X})\)</span> for the Liberia data analysis.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="spatially-continuous-targets" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="spatially-continuous-targets"><span class="header-section-number">5.3</span> Spatially continuous targets</h2>
<p>In the previous section, we explained and demonstrated how to obtain Monte Carlo samples from the predictive distribution of <span class="math inline">\(S(\tilde{X})\)</span>, which we denoted by <span class="math inline">\([S(\tilde{X}) \: |\: y]\)</span>. Let <span class="math inline">\(S_{(j)}(\tilde{X})\)</span> and <span class="math inline">\([S(\tilde{X}) \: |\: y]\)</span> represent the <span class="math inline">\(j\)</span>-th Monte Carlo samples for the entire grid and the specific location <span class="math inline">\(x_k\)</span>, respectively, for <span class="math inline">\(j=1,\ldots,B\)</span> and <span class="math inline">\(k=1,\ldots,q\)</span>.</p>
<p>We define our predictive target, <span class="math inline">\(T(x)\)</span>, at any given location <span class="math inline">\(x\)</span>, as a transformation of <span class="math inline">\(S(x)\)</span>. Thus, we express it as <span class="math inline">\(T(x) = f\{S(x)\}\)</span>. Note that <span class="math inline">\(f(\cdot)\)</span> can represent any type of non-linear transformation of <span class="math inline">\(S(x)\)</span> and may include covariate effects and other non-structured random effects. A list of common predictive targets frequently used in geostatistical analysis is provided in <a href="#tbl-spat-cont-pred-target">Table&nbsp;<span>5.1</span></a>.</p>
<div id="tbl-spat-cont-pred-target" class="anchored">
<table class="table">
<caption>Table&nbsp;5.1: List of some of the most common spatially continuous predictive targets in a geostatistical analysis. For each target, we also indicate the generalized linear model (GLM) family for which these can be defined. Note that this list not exhaustive and different predictive other than those listed in the table could also be considered.</caption>
<colgroup>
<col style="width: 38%">
<col style="width: 30%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th>Predictive target <span class="math inline">\(T(x)\)</span></th>
<th>Name of the predictive target</th>
<th>Generalized linear model (GLM) family</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(d(x)^\top \beta + S(x)\)</span></td>
<td>Linear predictor</td>
<td>Any GLM</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\frac{\exp\{d(x)^\top \beta + S(x)\}}{1+\exp\{d(x)^\top \beta + S(x)\}}\)</span></td>
<td>Prevalence</td>
<td>Binomial</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\exp\{d(x)^\top \beta + S(x)\}\)</span></td>
<td>Mean number of cases</td>
<td>Poisson</td>
</tr>
<tr class="even">
<td><span class="math inline">\(S(x)\)</span></td>
<td>Spatial random effects</td>
<td>Any GLM</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(d(x)^\top \beta\)</span></td>
<td>Covariates effects</td>
<td>Any GLM</td>
</tr>
</tbody>
</table>
</div>
<p>An important feature of the predictive targets listed in <a href="#tbl-spat-cont-pred-target">Table&nbsp;<span>5.1</span></a> is that none of them include the nugget effect, denoted by <span class="math inline">\(Z_i\)</span> in our linear predictor definition for generalized linear geostatistical models. The reason for excluding <span class="math inline">\(Z_i\)</span> from the predictive targets is that, in most cases, it lacks a clear, unambiguous scientific interpretation. However, <span class="math inline">\(Z_i\)</span> might be included, for example, in environmental studies focusing on highly localized phenomena where measurement error or small-scale variability is of direct scientific interest; or in epidemiological studies where inferences at the individual level, rather than the population level, are required, and where <span class="math inline">\(Z_i\)</span> is introduced to account for unexplained individual-level variation. It is also worth noticing, the primary impact of including <span class="math inline">\(Z_i\)</span> in <span class="math inline">\(T(x)\)</span> would be an increase in the uncertainty of predictive inferences for <span class="math inline">\(T(x)\)</span>, with minimal effect (or none at all, if <span class="math inline">\(T(x)\)</span> corresponds to the linear predictor) on the point predictions.</p>
<p>The predictive targets in <a href="#tbl-spat-cont-pred-target">Table&nbsp;<span>5.1</span></a> corresponding to <span class="math inline">\(d(x)^\top \beta\)</span> or the spatial random effects <span class="math inline">\(S(x)\)</span> might be considered when the goal is to highlight the different contribution to the overall predictive inferences from the measured covariates.</p>
<section id="example-mapping-riverblidness-prevalence-in-liberia-continuing-from-sec-pred-samples" class="level4" data-number="5.3.0.1">
<h4 data-number="5.3.0.1" class="anchored" data-anchor-id="example-mapping-riverblidness-prevalence-in-liberia-continuing-from-sec-pred-samples"><span class="header-section-number">5.3.0.1</span> Example: mapping riverblidness prevalence in Liberia (continuing from <a href="#sec-pred-samples"><span>Section&nbsp;5.2.1</span></a>)</h4>
<p>Let us continue the geostatistical of the riverblindness data in Liberia. The predictive target we consider is prevalence, hence <span class="math display">\[T(x) = \frac{\exp\{ \beta_{0} + \beta_{1}\log\{e(x)\} + S(x)\}}{1+\exp\{\beta_{0} + \beta_{1}\log\{e(x)\} + S(x)\}}\]</span>, where <span class="math inline">\(e(x)\)</span> is the elevation in meters at location <span class="math inline">\(x\)</span>.</p>
<p>Through the <code>pred_target_grid</code> we can use the output in <code>lb_pred_S_m</code> (or <code>lb_pred_S_j</code> as well, in this case) to generate predictions of prevalence over the regular grid at 5 km we have created earlier.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Prediction of riverblindness prevalence</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>lb_prev <span class="ot">&lt;-</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pred_target_grid</span>(</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  lb_pred_S_m, </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">f_target =</span> <span class="fu">list</span>(<span class="at">prev =</span> <span class="cf">function</span>(lp) <span class="fu">exp</span>(lp)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(lp))),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">pd_summary =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="cf">function</span>(Tx) <span class="fu">mean</span>(Tx), </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">cv =</span> <span class="cf">function</span>(Tx) <span class="fu">sd</span>(Tx)<span class="sc">/</span> <span class="fu">mean</span>(Tx),</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">exceed20 =</span> <span class="cf">function</span>(Tx) <span class="fu">mean</span>(Tx <span class="sc">&gt;</span> <span class="fl">0.2</span>))</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the function above the argument <code>f_target</code> can take a list of functions, as multiple predictive targets can be defined. Here, we only specified prevalence (<code>prev</code>). Note that in defining the predictive target in <code>f_target</code>, we need to express that as a function of <span class="math inline">\(d(x)^\top \beta + S(x)\)</span>. The argument <code>include_covariates</code> also allows us to define predictive target that do not use covariates from the model. By default <code>include_covariates = TRUE</code>, hence in the code above covariates are part of what is defined as <code>lp</code>. To predict the spatial random effects <span class="math inline">\(S(x)\)</span> only, for example, you can set <code>include_covariates = FALSE</code> and <code>f_target = list(Sx = function(lp) lp)</code>. In <code>pd_summary</code>, we define the summaries that we want to visualize from the predictive distribution. Here, we have specified the mean, coefficient of variation and the probability of exceeding a 20<span class="math inline">\(\%\)</span> prevalence threshold.</p>
<p>We can then visualize the resulting maps as follows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Displying the results</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lb_prev, <span class="at">which_target =</span> <span class="st">"prev"</span>, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">which_summary =</span> <span class="st">"mean"</span>, <span class="at">main =</span> <span class="st">"Mean"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lb_prev, <span class="at">which_target =</span> <span class="st">"prev"</span>, </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">which_summary =</span> <span class="st">"cv"</span>, <span class="at">main =</span> <span class="st">"Coefficient of variation"</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lb_prev, <span class="at">which_target =</span> <span class="st">"prev"</span>, </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">which_summary =</span> <span class="st">"exceed20"</span>, <span class="at">main =</span> <span class="st">"Exceedance probability"</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-lb-maps" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="05_geostatistical-prediction_files/figure-html/fig-lb-maps-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5.2: Mapping riverblindness in Liberia. Plots of the mean (left panel), coefficient of variation (central panel) and exceedance probability (right panel) for a 20% prevalence threshold.</figcaption>
</figure>
</div>
</div>
</div>
<p>The maps in <a href="#fig-lb-maps">Figure&nbsp;<span>5.2</span></a> indicate a higher prevalence as we move away from the coast and at higher altitudes. A very similar spatial pattern is observed in the likelihood of exceeding 20<span class="math inline">\(\%\)</span> prevalence. Also, based on the map of the coefficient of variation, the uncertainty around the point predictions of prevalence is higher along the coast and lower in the inland areas of Liberia.</p>
</section>
<section id="sec-non-spar-covariates" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="sec-non-spar-covariates"><span class="header-section-number">5.3.1</span> Example: mapping malaria using age and elevation as predictors</h3>
<p>We now consider an example on malaria mapping, where we use two different types of covariates: a spatially referenced covariate corresponding to elevation; the individual age. We use the <code>malkenya_comm</code> subset of the <code>malkenya</code> data-set (see <a href="03_model-fitting.html#sec-indiv-expl-analysis"><span>Section&nbsp;3.1.1.2</span></a>) and, to alleviate the computational burden, we further reduce this data-set by taking the first 1000 rows. Hence, we create our new data-set, <code>malkenya_comm1000</code>, using the followind code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>malkenya_comm1000 <span class="ot">&lt;-</span> malkenya_comm[<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>,]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>malkenya_comm1000 <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(malkenya_comm1000, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Long"</span>, <span class="st">"Lat"</span>),</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>malkenya_comm1000 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(malkenya_comm1000, <span class="at">crs =</span> <span class="dv">32736</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Based on the exploratory analysis shown in <a href="03_model-fitting.html#sec-indiv-expl-analysis"><span>Section&nbsp;3.1.1.2</span></a>, we consider a geostatistical model fitted to the individual binary outcomes, <span class="math inline">\(Y_{ij}\)</span>, which correspond the rapid diagnostic test (RDT) results for the <span class="math inline">\(j\)</span>-th individual in the <span class="math inline">\(i\)</span>-th community, and take value <span class="math inline">\(Y_{ij}=1\)</span> if the RDT is positive and <span class="math inline">\(Y_{ij}=0\)</span> if the RDT is negative. Using a Binomial geostatistical model, we model the individual probability, <span class="math inline">\(p_{ij}\)</span> of a positive RDT using the following linear predictor. <span id="eq-lp-malkenya"><span class="math display">\[
\log\left\{\frac{p_{ij}}{1-p_{ij}}\right\} = \beta_{0} + \beta_{1}a_{ij}+\beta_{2} \times\max\{a_{ij}-15, 0\} + \beta_{3}\max\{a_{ij}-40, 0\} + \beta_{4} e(x_i) + S(x_i),
\tag{5.1}\]</span></span> where <span class="math inline">\(e(x_{i})\)</span> and <span class="math inline">\(a_{ij}\)</span> are the elevation in meter and the age in years for the <span class="math inline">\(j\)</span>-th individual residing at the <span class="math inline">\(i\)</span>-th household, respectively.</p>
<p>When using the model in <a href="#eq-lp-malkenya">Equation&nbsp;<span>5.1</span></a> to predict RDT prevalence, a key question arises: how should we handle the age variable, which, unlike elevation, is not available as a geo-referenced covariate at all locations in the study area? The answer depends on the research question being addressed.</p>
<p>For instance, if the goal is to infer disease risk across different age groups, we can generate different maps for each group of interest. This can be easily achieved by fixing the value of <span class="math inline">\(a_{ij}\)</span> to a specific age for all prediction locations. Alternatively, if the objective is to generate a predictive map for the general population, rather than for a specific age group, we must employ a probabilistic model for age and integrate out its effect.</p>
<p>Developing a credible probabilistic model for age is beyond the scope of this section. Instead, we demonstrate a simple yet reasonable solution which uses the empirical age distribution from the data. By random sampling from this distribution, we can then assign age values to prediction locations. The steps are as follows.</p>
<ol type="1">
<li>Obtain the empirical distribution of age from the data.</li>
<li>Sample with replacement from such distribution (the <code>sample</code> function in R can be used for this purpose) as many times as the number of prediction locations, so that each grid location <span class="math inline">\(\tilde{x}\)</span> has a value of age assigned.</li>
<li>Generate a sample from the predictive distribution of the target <span class="math inline">\(T(\tilde{x})\)</span> at each of the grid locations <span class="math inline">\(\tilde{x}\)</span>.</li>
<li>Repeat 1 to 3, for as many times as the samples generates from <span class="math inline">\(S(\tilde{X})\)</span>.</li>
</ol>
<p>This approach relies on two key assumptions. First, that the age distribution is spatially neutral, i.e., it does not vary across space. Second, that the data are representative of the age distribution in the target population. In the data used for this example, we believe these assumptions are reasonable, given the relatively small study area, where age is unlikely to exhibit significant spatial variation, and the fact that the data are a random sample from the community.</p>
<p>In the scripts presented in the remainder of this section, we show how to generate a predictive map of prevalence for children age 15 years, and another map that instead uses the approach earlier described to remove the effect of age and generate a map of prevalence for the general population.</p>
<p>First, we fit the model. Note that the effect of age is not linear and we use linear splines to account for this, using the results of the exploratory analysis shown in @<a href="03_model-fitting.html#sec-indiv-expl-analysis"><span>Section&nbsp;3.1.1.2</span></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>fit_malkenya <span class="ot">&lt;-</span> <span class="fu">glgpm</span>(RDT <span class="sc">~</span> Age <span class="sc">+</span>  <span class="fu">pmax</span>(Age<span class="dv">-15</span>, <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">pmax</span>(Age<span class="dv">-40</span>, <span class="dv">0</span>) <span class="sc">+</span> elevation <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">gp</span>(),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> malkenya_comm1000,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="st">"binomial"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After fitting the model, we create a prediction grid at a spatial resolution of 500 meters and extract the values of elevation. In this analysis, due to the small size of the study area, we do not use administrative boundaries as they are too large. Instead, we use the convex hull<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> of the sample locations to define the boundaries of our study area.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create grid from convex hull</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>shp_ch <span class="ot">&lt;-</span> <span class="fu">convex_hull_sf</span>(malkenya_comm1000)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>ken_grid <span class="ot">&lt;-</span> <span class="fu">create_grid</span>(shp_ch, <span class="at">spat_res =</span> <span class="fl">0.5</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Get elevation raster</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>ken_elev <span class="ot">&lt;-</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">get_elev_raster</span>(<span class="at">locations =</span> shp_ch, </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">z =</span> <span class="dv">9</span>, <span class="at">clip =</span> <span class="st">"locations"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We then create the data frame of predictors where age is set to 15.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the data fr</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>ken_predictors <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">elevation =</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">extract</span>(ken_elev, <span class="fu">st_coordinates</span>(ken_grid)),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Age =</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now have all the ingredients to carry out prediction.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>pred_ken_S <span class="ot">&lt;-</span> <span class="fu">pred_over_grid</span>(fit_malkenya, <span class="at">grid_pred =</span> ken_grid,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">predictors =</span> ken_predictors)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>pred_age15 <span class="ot">&lt;-</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">pred_target_grid</span>(pred_ken_S, </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">f_target =</span> <span class="fu">list</span>(<span class="at">prev =</span> <span class="cf">function</span>(lp) <span class="fu">exp</span>(lp)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(lp))),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">pd_summary =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="cf">function</span>(Tx) <span class="fu">mean</span>(Tx)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code below shows how to perform the 4 steps described above to generate a predictive map for the general population. Below we use the function <code>update_predictors</code> to update the covariates effects that are stored in <code>mu_pred</code>, a list element generated as the output of <code>pred_over_grid</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of Monte Carlo samples</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>n_sim <span class="ot">&lt;-</span> <span class="fu">ncol</span>(pred_age15<span class="sc">$</span>lp_samples)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of prediction locations</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>n_pred <span class="ot">&lt;-</span> <span class="fu">nrow</span>(predictors)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The create object `pred_ken_S_i` with the goal of changing the </span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># coviariates effects stored in `mu_pred` according the sample values of age</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>pred_ken_S_i <span class="ot">&lt;-</span> pred_ken_S</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>pred_ken_S_i<span class="sc">$</span>mu_pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_pred, <span class="at">ncol =</span> n_sim)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sim) {</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate n_pred samples from the empirical distribution of age</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  ken_predictors<span class="sc">$</span>Age <span class="ot">&lt;-</span> <span class="fu">sample</span>(malkenya_comm1000<span class="sc">$</span>Age, n_pred, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate the new covariates effects with `update_predictors` and store them in </span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># `mu_pred`</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  pred_ken_S_i<span class="sc">$</span>mu_pred[,i] <span class="ot">&lt;-</span> <span class="fu">update_predictors</span>(pred_ken_S, ken_predictors)<span class="sc">$</span>mu_pred</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Prediction of prevalence</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>pred_aver_pop <span class="ot">&lt;-</span> <span class="fu">pred_target_grid</span>(pred_ken_S_i, </span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">f_target =</span> <span class="fu">list</span>(<span class="at">prev =</span> <span class="cf">function</span>(lp) <span class="fu">exp</span>(lp)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(lp))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now plot the two maps and compare them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pred_age15, <span class="at">which_target =</span> <span class="st">"prev"</span>, <span class="at">which_summary =</span> <span class="st">"mean"</span>, <span class="at">main =</span> <span class="st">"Prevalence (15 years)"</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.6</span>))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pred_aver_pop, <span class="at">which_target =</span> <span class="st">"prev"</span>, <span class="at">which_summary =</span> <span class="st">"mean"</span>,  <span class="at">main =</span> <span class="st">"Prevalence (General population)"</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.6</span>))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-malaria-maps" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="05_geostatistical-prediction_files/figure-html/fig-malaria-maps-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5.3: Maps of the predictive mean of the rapid diagnostic test (RDT) prevalence for children of the age of 15 (left panel) and the general population (right panel).</figcaption>
</figure>
</div>
</div>
</div>
<p>The exploratory analysis of <a href="03_model-fitting.html#sec-indiv-expl-analysis"><span>Section&nbsp;3.1.1.2</span></a> had shown that the prevalence around the age of 15 is higher than at other ages. This is also reflected in <a href="#fig-malaria-maps">Figure&nbsp;<span>5.3</span></a>, when the left panel, corresponding to the RDT prevalence for children at the age of 15 years, shows a higher level of prevalence than the right panel, which is instead for the general population.</p>
</section>
</section>
<section id="areal-level-targets" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="areal-level-targets"><span class="header-section-number">5.4</span> Areal-level targets</h2>
<p>When determining areal-level targets, we must first address the following questions:</p>
<ol type="1">
<li>What spatially continuous target, <span class="math inline">\(T(x)\)</span>, are we seeking to aggregate?</li>
<li>What are the spatial units, denoted as <span class="math inline">\(A_i\)</span> for <span class="math inline">\(i = 1, \dots, N\)</span>, over which the aggregation is required?</li>
<li>What aggregating function should be applied?</li>
<li>Should spatial weights be incorporated in the aggregation, and if so, what weights are appropriate?</li>
</ol>
<p>The first question was discussed in earlier sections, where examples of predictive targets that define <span class="math inline">\(T(x)\)</span> can be found in <a href="#tbl-spat-cont-pred-target">Table&nbsp;<span>5.1</span></a>. The answers to the remaining questions are context-dependent and closely linked to the primary research objectives. In public health settings, the areas <span class="math inline">\(A_i\)</span> often correspond to administrative units or regions where decisions are made and resources are allocated.</p>
<p>A common aggregating function for <span class="math inline">\(T(x)\)</span> is the mean, which is formally defined as:</p>
<p><span id="eq-mean-alt"><span class="math display">\[
\mathcal{M}_i = \frac{1}{|A_i|}\int_{A_i} T(x) \: dx.
\tag{5.2}\]</span></span></p>
<p>In addition to the mean, several other aggregating functions can be applied depending on the context of the analysis.</p>
<p>For instance, in the study of Anopheles mosquitoes in Cameroon, we may be interested in estimating the total number of mosquitoes trapped within the study area (<span class="math inline">\(A_i\)</span> represents a single region in this case). If <span class="math inline">\(T(x)\)</span> denotes the number of mosquitoes trapped at location <span class="math inline">\(x\)</span>, the areal-level target can be expressed as: <span class="math display">\[
  \mathcal{S}_i = \int_{A_i} T(x) \: dx.
  \]</span></p>
<p>Additionally, to capture the heterogeneity of <span class="math inline">\(T(x)\)</span> within an area, variance-based measures can be used. The variance of <span class="math inline">\(T(x)\)</span> in <span class="math inline">\(A_i\)</span> is given by: <span class="math display">\[
   \mathcal{V}_i = \frac{1}{|A_i|}\int_{A_i} \left(T(x) - \mathcal{M}_i\right)^2 \: dx,
   \]</span> where <span class="math inline">\(\mathcal{M}_i\)</span> is the mean of <span class="math inline">\(T(x)\)</span> in <span class="math inline">\(A_i\)</span>.</p>
<p>The formulation of the areal-level targets given so far assumes equal weighting for all locations within the area. Alternatively, if the we consider for example the areal level target in <a href="#eq-mean-alt">Equation&nbsp;<span>5.2</span></a>, one could use spatial weights, <span class="math inline">\(w(x) &gt; 0\)</span>, and redefine <span class="math inline">\(\mathcal{M}_i\)</span> as:</p>
<p><span class="math display">\[
\mathcal{M}_i = \frac{\int_{A_i} w(x) T(x) \: dx}{\int_{A_i} w(x) \: dx}.
\]</span></p>
<p>Selecting appropriate spatial weights is crucial, as it reflects the significance of different locations within the area. We can define three types of weighting: population-density, risk-based, and distance-based. We point out that this distinction is not always clear cut (population could indeed be a risk factor in our analysis) but this classification is made only for the sake of making the explanation clearer.</p>
<p>For example, if the goal is to prioritize areas with higher populations, weights <span class="math inline">\(w(x)\)</span> could be proportional to population density at location <span class="math inline">\(x\)</span>. This approach gives greater importance to locations where more people reside, which can be particularly relevant when aggregating disease prevalence data for resource allocation.</p>
<p>In cases where certain sub-regions within <span class="math inline">\(A_i\)</span> are at higher risk for disease (e.g., proximity to environmental hazards or areas with lower access to healthcare), risk-based weights could be applied. Here, <span class="math inline">\(w(x)\)</span> would be higher in regions identified as higher risk, providing a more targeted aggregation of disease prevalence. For example, populations in rural areas may face higher exposure to infectious diseases than those in urban areas, making it important to assign greater weight to these higher-risk regions in the aggregation process.</p>
<p>If the objective is to account for proximity effects (such as the spread of an infectious disease or contamination from a known source), distance-based weights could be used. Locations closer to a known disease outbreak area or source of exposure could be given more weight to reflect the spatial dynamics of disease transmission.</p>
<p>Using spatial weights in these ways ensures that the aggregation of disease prevalence <span class="math inline">\(T(x)\)</span> reflects not only the distribution of the disease but also the underlying population, risk, or spatial characteristics relevant to the public health problem under investigation.</p>
</section>
<section id="comparing-the-predictive-performance-of-geostatistical-models" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="comparing-the-predictive-performance-of-geostatistical-models"><span class="header-section-number">5.5</span> Comparing the predictive performance of geostatistical models</h2>
</section>
<section id="sec-theory-prediction" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="sec-theory-prediction"><span class="header-section-number">5.6</span> Theory</h2>
<section id="sec-pred-distr-theory" class="level3" data-number="5.6.1">
<h3 data-number="5.6.1" class="anchored" data-anchor-id="sec-pred-distr-theory"><span class="header-section-number">5.6.1</span> Derivation of the predictive distribution</h3>
</section>
<section id="scoring-rules" class="level3" data-number="5.6.2">
<h3 data-number="5.6.2" class="anchored" data-anchor-id="scoring-rules"><span class="header-section-number">5.6.2</span> Scoring rules</h3>
</section>
</section>
<section id="common-questions-from-users" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="common-questions-from-users"><span class="header-section-number">5.7</span> Common questions from users</h2>
<ul>
<li><p><em>What should be the spatial resolution of the grid used for prediction?</em></p></li>
<li><p><em>I have covariates with different spatial resolutions. Which spatial resolution should I use?</em></p></li>
<li><p><em>My prediction map looks like noise. What could be the error?</em></p></li>
<li><p><em>The main goal of my analysis is to carry out predictions of the main outcome. However, can I also use the model to draw inferences on the association between the outcome and the covariates that I have included in the model?</em></p></li>
<li><p><em>In my model I have some covariates that are attached to the individual (e.g.&nbsp;age, gender, occupation, etc.). How do I specify them when doing prediction?</em> <br> Read <a href="#sec-non-spar-covariates"><span>Section&nbsp;5.3.1</span></a>.</p></li>
</ul>
</section>
<section id="exercises" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="exercises"><span class="header-section-number">5.8</span> Exercises</h2>
<ol type="1">
<li><em>Review questions</em>.
<ul>
<li>What are the steps that needs to taken when performing spatial prediction?</li>
<li>Define the predictive distribution of a predictive target and explain how this is used to answer a research question.</li>
<li>Distinguish between spatially continuous and areal-level targets, giving at least two examples for each.</li>
<li>Explain the difference between marginal and joint predictions, and for which targets each can be used.</li>
</ul></li>
<li></li>
</ol>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-amazigo2008" class="csl-entry" role="listitem">
Amazigo, U. 2008. <span>“The African Programme for Onchocerciasis Control (APOC).”</span> <em>Ann Trop Med Parasitol</em> 102 (Suppl 1): 19–22. <a href="https://doi.org/10.1179/136485908X337436">https://doi.org/10.1179/136485908X337436</a>.
</div>
<div id="ref-diggle1998" class="csl-entry" role="listitem">
Diggle, P. J., J. A. Tawn, and R. A. Moyeed. 1998. <span>“Model-Based Geostatistics.”</span> <em>Journal of the Royal Statistical Society: Series C (Applied Statistics)</em> 47 (3): 299–350. <a href="https://doi.org/10.1111/1467-9876.00113">https://doi.org/10.1111/1467-9876.00113</a>.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Here, we are overlooking the fact that when <span class="math inline">\(T(x)\)</span> is a linear transformation of <span class="math inline">\(S(x)\)</span> and the the model fitted to the data is a linear geostatistical model, then we can derive any summary of the predictive distribution analytically, without the need of carrying out any simulation. Although this may displease some of our fellow statisticians who care about computational efficiency, for pedagogical reasons, here we have chosen to explain only the Monte Carlo based approach, which works in all scenarios.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The convex hull of a set of spatial locations is the smallest possible shape (usually a polygon) that completely encloses all the points, such that if you take any two points inside the shape, the straight line connecting them is also entirely inside the shape. In simple terms, it can be thought of as stretching a rubber band around the outermost points in a set, and the shape the rubber band forms is the convex hull.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./04_model-validation.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Model validation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./06_case-studies.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Case studies</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>